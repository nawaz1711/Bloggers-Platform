<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MindScroll — Thoughts that keep scrolling.</title>
<style>
  :root{
    --bg:#f7fafc; --card:#ffffff; --muted:#6b7280; --accent:#4f46e5;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:#111}
  .container{max-width:1000px;margin:28px auto;padding:0 16px}
  header{display:flex;align-items:center;justify-content:space-between;padding:12px 0}
  .brand{font-weight:700;color:var(--accent);font-size:20px;text-decoration:none}
  nav a{margin-left:12px;color:#111;text-decoration:none;font-size:14px}
  .topbar{display:flex;gap:8px;align-items:center}
  button{cursor:pointer}
  .btn{background:var(--accent);color:#fff;padding:8px 12px;border-radius:6px;border:0}
  .ghost{background:transparent;border:1px solid #ddd;padding:6px 10px;border-radius:6px}
  .layout{display:grid;grid-template-columns:1fr 320px;gap:20px;margin-top:18px}
  .card{background:var(--card);padding:16px;border-radius:10px;box-shadow:0 1px 3px rgba(0,0,0,.05)}
  .post-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px}
  .post-card{padding:14px;border-radius:8px;border:1px solid #eef2ff;background:linear-gradient(180deg,#fff,#fbfdff)}
  .post-card h3{margin:0 0 8px;font-size:16px}
  .meta{font-size:12px;color:var(--muted)}
  .search{width:100%;padding:8px;border-radius:8px;border:1px solid #e5e7eb}
  .tags{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  .tag{background:#eef2ff;color:var(--accent);padding:6px 8px;border-radius:999px;font-size:12px}
  main .content{margin-top:12px}
  .post-body{line-height:1.6}
  .form-row{display:flex;flex-direction:column;gap:8px;margin-bottom:12px}
  input[type=text], textarea, select{padding:10px;border-radius:8px;border:1px solid #e6e6e6}
  textarea{min-height:180px;resize:vertical}
  .small{font-size:13px;color:var(--muted)}
  .center{display:flex;gap:8px;align-items:center}
  .muted{color:var(--muted)}
  footer{margin:36px 0;text-align:center;color:var(--muted);font-size:13px}
  @media (max-width:900px){ .layout{grid-template-columns:1fr} .topbar{gap:6px} }
</style>
</head>
<body>
  <div class="container">
    <header>
      <a class="brand" href="#/">MindScroll</a>
      <div class="topbar">
        <input id="searchInput" class="search" placeholder="Search posts or tags..." />
        <div id="authArea"></div>
      </div>
    </header>

    <div class="layout">
      <main id="mainView">
        <!-- dynamic content -->
      </main>

      <aside>
        <div class="card">
          <h4>Create</h4>
          <p class="small">Start a quick draft (saved locally)</p>
          <div style="margin-top:8px">
            <button id="btnNewPost" class="btn">New Post</button>
          </div>
        </div>

        <div style="height:12px"></div>

        <div class="card">
          <h4>Tags</h4>
          <div id="tagList" class="tags"></div>
        </div>

        <div style="height:12px"></div>

        <div class="card">
          <h4>About</h4>
          <p class="small">MindScroll — Thoughts that keep scrolling. Lightweight blogging template — HTML/CSS/JS only. Posts & users are stored in your browser <code>localStorage</code>.</p>
        </div>
      </aside>
    </div>

    <footer>© <span id="year"></span> MindScroll — Thoughts that keep scrolling.</footer>
  </div>

<script>
/* ---------------------------
  MindScroll — client-side blogger SPA
  Data stored in localStorage:
    - users: array of user objects {id, username, email, bio}
    - posts: array of post objects {id, title, content, authorId, tags[], createdAt, status}
    - session: {userId}
----------------------------*/
const $ = sel => document.querySelector(sel);
const qs = sel => document.querySelectorAll(sel);

const LS = {
  get(k){ try { return JSON.parse(localStorage.getItem(k)); } catch { return null; } },
  set(k,v){ localStorage.setItem(k, JSON.stringify(v)); }
};

// bootstrap demo data if empty
if(!LS.get('users')){
  const demoUsers = [
    { id: 'u1', username: 'alice', email:'alice@example.com', bio:'A storyteller.', createdAt: Date.now() },
    { id: 'u2', username: 'bob', email:'bob@example.com', bio:'Tech & thoughts.', createdAt: Date.now() }
  ];
  LS.set('users', demoUsers);
}
if(!LS.get('posts')){
  const demoPosts = [
    { id:'p1', title:'Welcome to MindScroll', content:'<p>Welcome — this is a simple demo post on MindScroll. Share your thoughts and let them keep scrolling.</p>', authorId:'u1', tags:['intro','welcome'], createdAt: Date.now()-86400000, status:'published' },
    { id:'p2', title:'Writing Tips for Daily Practice', content:'<p>Write every day. Read more. Edit ruthlessly. Keep the scroll alive.</p>', authorId:'u2', tags:['writing','tips'], createdAt: Date.now()-3600000, status:'published' }
  ];
  LS.set('posts', demoPosts);
}
if(!LS.get('session')) LS.set('session', null);

/* util */
const uid = (p='id') => p + '_' + Math.random().toString(36).slice(2,9);
const now = ()=> new Date().toISOString();

/* routing */
window.addEventListener('hashchange', route);
document.addEventListener('DOMContentLoaded', ()=>{ $('#year').innerText = new Date().getFullYear(); initUI(); route(); });

/* UI init */
function initUI(){
  $('#btnNewPost').addEventListener('click', ()=> location.hash = '#/new');
  $('#searchInput').addEventListener('input', e => {
    const q = e.target.value.trim().toLowerCase();
    if(q) location.hash = '#/search/' + encodeURIComponent(q);
    else location.hash = '#/';
  });
  renderAuthArea();
  renderTagList();
}

/* render auth area */
function renderAuthArea(){
  const session = LS.get('session');
  const users = LS.get('users') || [];
  const el = $('#authArea');
  el.innerHTML = '';
  if(session && session.userId){
    const user = users.find(u=>u.id===session.userId);
    if(user){
      const wrap = document.createElement('div');
      wrap.className = 'center';
      const name = document.createElement('a');
      name.href = '#/profile/' + user.id;
      name.textContent = user.username;
      name.style.marginRight = '8px';
      const btn = document.createElement('button');
      btn.className = 'ghost';
      btn.textContent = 'Logout';
      btn.onclick = ()=>{ LS.set('session', null); renderAuthArea(); route(); };
      wrap.append(name, btn);
      el.appendChild(wrap);
      return;
    }
  }
  // not logged in
  const login = document.createElement('button');
  login.className = 'ghost';
  login.textContent = 'Login';
  login.onclick = ()=> openAuthModal('login');
  const register = document.createElement('button');
  register.className = 'btn';
  register.style.marginLeft='6px';
  register.textContent = 'Sign Up';
  register.onclick = ()=> openAuthModal('register');
  el.append(login, register);
}

/* tags */
function renderTagList(){
  const posts = LS.get('posts') || [];
  const tagMap = {};
  posts.forEach(p => (p.tags||[]).forEach(t => tagMap[t] = (tagMap[t]||0)+1));
  const tagList = $('#tagList');
  tagList.innerHTML = '';
  Object.keys(tagMap).sort().forEach(t => {
    const a = document.createElement('a');
    a.href = '#/tag/' + encodeURIComponent(t);
    a.className = 'tag';
    a.textContent = `${t} (${tagMap[t]})`;
    tagList.appendChild(a);
  });
}

/* main router */
function route(){
  const hash = location.hash.slice(1) || '/';
  const main = $('#mainView');
  main.innerHTML = '';
  const parts = hash.split('/').filter(Boolean);
  if(hash === '/' || parts.length===0) return renderHome(main);
  if(parts[0] === 'post' && parts[1]) return renderPost(main, parts[1]);
  if(parts[0] === 'new') return renderEditor(main);
  if(parts[0] === 'edit' && parts[1]) return renderEditor(main, parts[1]);
  if(parts[0] === 'profile' && parts[1]) return renderProfile(main, parts[1]);
  if(parts[0] === 'tag' && parts[1]) return renderTag(main, decodeURIComponent(parts[1]));
  if(parts[0] === 'search' && parts[1]) return renderSearch(main, decodeURIComponent(parts[1]));
  main.appendChild(elWrap('<div class="card"><h3>Not Found</h3><p>Page does not exist.</p></div>'));
}

/* helpers to create DOM */
function elWrap(html){
  const d = document.createElement('div');
  d.innerHTML = html;
  return d.firstElementChild;
}

/* Home -> list posts */
function renderHome(root){
  const posts = (LS.get('posts')||[]).filter(p => p.status === 'published').sort((a,b)=> new Date(b.createdAt)-new Date(a.createdAt));
  const u = LS.get('users')||[];
  const section = document.createElement('div');
  section.innerHTML = `<div class="card"><h2>Latest Posts</h2><div style="height:8px"></div></div>`;
  const grid = document.createElement('div');
  grid.className = 'post-grid';
  posts.forEach(p => {
    const author = u.find(x=>x.id===p.authorId) || {username:'Unknown'};
    const card = document.createElement('div');
    card.className = 'post-card';
    card.innerHTML = `
      <h3>${escapeHtml(p.title)}</h3>
      <div class="small muted">${formatDate(p.createdAt)} • by <a href="#/profile/${author.id}">${escapeHtml(author.username)}</a></div>
      <div style="height:8px"></div>
      <div class="small" style="color:#374151">${(stripHtml(p.content) || '').slice(0,120)}${stripHtml(p.content).length>120?'...':''}</div>
      <div style="height:8px"></div>
      <div class="center"><a class="ghost" href="#/post/${p.id}">Read</a></div>
    `;
    grid.appendChild(card);
  });
  section.appendChild(grid);
  root.appendChild(section);
}

/* view single post */
function renderPost(root, id){
  const posts = LS.get('posts') || [];
  const post = posts.find(p=>p.id===id);
  if(!post) return root.appendChild(elWrap('<div class="card"><h3>Post not found</h3></div>'));
  const users = LS.get('users')||[];
  const author = users.find(u=>u.id===post.authorId) || {username:'Unknown', id:''};
  const card = document.createElement('div');
  card.className = 'card';
  card.innerHTML = `
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <h1 style="margin:0">${escapeHtml(post.title)}</h1>
        <div class="small muted">${formatDate(post.createdAt)} • by <a href="#/profile/${author.id}">${escapeHtml(author.username)}</a></div>
      </div>
      <div class="center"></div>
    </div>
    <div class="content" style="margin-top:12px">
      <div class="post-body">${post.content}</div>
    </div>
    <div style="height:8px"></div>
    <div class="small muted">Tags: ${(post.tags||[]).map(t=>`<a href="#/tag/${encodeURIComponent(t)}" class="tag" style="display:inline-block;margin-right:6px;margin-bottom:6px">${escapeHtml(t)}</a>`).join('')}</div>
  `;
  const session = LS.get('session');
  if(session && session.userId === post.authorId){
    const ctrl = card.querySelector('.center');
    const edit = document.createElement('a'); edit.href = '#/edit/' + post.id; edit.className='ghost'; edit.textContent='Edit';
    const del = document.createElement('button'); del.className='ghost'; del.textContent='Delete';
    del.onclick = ()=>{ if(confirm('Delete this post?')){ deletePost(post.id); location.hash = '#/'; } };
    ctrl.append(edit, del);
  }
  root.appendChild(card);
}

/* editor for new/edit */
function renderEditor(root, editId){
  const session = LS.get('session');
  if(!session || !session.userId) return root.appendChild( elWrap('<div class="card"><h3>Login required</h3><p class="small">You must login to write posts.</p></div>') );
  const users = LS.get('users') || [];
  const me = users.find(u=>u.id===session.userId);
  const posts = LS.get('posts') || [];
  const post = editId ? posts.find(p=>p.id===editId) : { title:'', content:'', tags:[], status:'draft' };
  const wrap = document.createElement('div'); wrap.className='card';
  wrap.innerHTML = `
    <h2>${editId ? 'Edit Post' : 'New Post'}</h2>
    <div class="form-row"><input id="title" type="text" placeholder="Title" value="${escapeAttr(post.title)}" /></div>
    <div class="form-row"><textarea id="content" placeholder="Write your article...">${escapeHtmlAttr(post.content)}</textarea></div>
    <div class="form-row"><input id="tags" placeholder="tags (comma separated)" value="${(post.tags||[]).join(', ')}" /></div>
    <div class="form-row center">
      <select id="status"><option value="published">Publish</option><option value="draft">Draft</option></select>
      <div style="flex:1"></div>
      <button id="saveBtn" class="btn">${editId ? 'Save Changes' : 'Create Post'}</button>
      <a href="#/" class="ghost" style="margin-left:8px">Cancel</a>
    </div>
    <div class="small muted">Logged in as ${escapeHtml(me.username)}</div>
  `;
  root.appendChild(wrap);
  $('#status').value = post.status || 'draft';
  $('#saveBtn').addEventListener('click', ()=> {
    const title = $('#title').value.trim();
    const content = $('#content').value.trim();
    const tags = ($('#tags').value||'').split(',').map(s=>s.trim()).filter(Boolean);
    if(!title || !content){ alert('Title and content required'); return; }
    if(editId) updatePost(editId, { title, content, tags, status: $('#status').value });
    else createPost({ title, content, tags, status: $('#status').value, authorId: session.userId });
    renderTagList();
    location.hash = '#/';
  });
}

/* profile */
function renderProfile(root, userId){
  const users = LS.get('users')||[];
  const posts = LS.get('posts')||[];
  const u = users.find(x=>x.id===userId);
  if(!u) return root.appendChild(elWrap('<div class="card"><h3>User not found</h3></div>'));
  const card = document.createElement('div'); card.className='card';
  const userPosts = posts.filter(p=>p.authorId===userId).sort((a,b)=>new Date(b.createdAt)-new Date(a.createdAt));
  card.innerHTML = `
    <div style="display:flex;align-items:center;gap:12px">
      <div style="width:64px;height:64px;background:#eef2ff;border-radius:12px;display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--accent);">${u.username[0].toUpperCase()}</div>
      <div>
        <h2 style="margin:0">${escapeHtml(u.username)}</h2>
        <div class="small muted">${escapeHtml(u.bio||'')}</div>
      </div>
      <div style="margin-left:auto"></div>
    </div>
    <div style="height:12px"></div>
    <h3>Posts</h3>
    <div id="profilePosts"></div>
  `;
  root.appendChild(card);
  const list = root.querySelector('#profilePosts');
  if(userPosts.length===0) list.innerHTML = '<div class="small muted">No posts yet.</div>';
  else userPosts.forEach(p=>{
    const el = document.createElement('div');
    el.className = 'post-card';
    el.style.marginBottom='8px';
    el.innerHTML = `<h4 style="margin:0"><a href="#/post/${p.id}">${escapeHtml(p.title)}</a></h4><div class="small muted">${formatDate(p.createdAt)} • ${p.status}</div>`;
    list.appendChild(el);
  });
}

/* tag view */
function renderTag(root, tag){
  const posts = LS.get('posts') || [];
  const filtered = posts.filter(p => (p.tags||[]).includes(tag) && p.status==='published');
  const wrap = document.createElement('div'); wrap.className='card';
  wrap.innerHTML = `<h2>Tag: ${escapeHtml(tag)}</h2><div id="tagPosts"></div>`;
  root.appendChild(wrap);
  const container = wrap.querySelector('#tagPosts');
  if(filtered.length===0) container.innerHTML='<p class="small muted">No posts.</p>';
  else filtered.forEach(p=> container.appendChild(renderPostPreview(p)));
}

/* search */
function renderSearch(root, q){
  const posts = LS.get('posts') || [];
  const lc = q.toLowerCase();
  const found = posts.filter(p => (p.title+ ' ' + stripHtml(p.content) + ' ' + (p.tags||[]).join(' ')).toLowerCase().includes(lc) && p.status==='published');
  const wrap = document.createElement('div'); wrap.className='card';
  wrap.innerHTML = `<h2>Search results for "${escapeHtml(q)}"</h2><div id="searchPosts"></div>`;
  root.appendChild(wrap);
  const container = wrap.querySelector('#searchPosts');
  if(found.length===0) container.innerHTML='<p class="small muted">No results.</p>';
  else found.forEach(p=> container.appendChild(renderPostPreview(p)));
}

/* small preview element used by tag/search */
function renderPostPreview(p){
  const el = document.createElement('div');
  el.className='post-card';
  el.style.marginBottom='10px';
  el.innerHTML = `<h4 style="margin:0"><a href="#/post/${p.id}">${escapeHtml(p.title)}</a></h4><div class="small muted">${formatDate(p.createdAt)}</div>`;
  return el;
}

/* CRUD for posts */
function createPost(data){
  const posts = LS.get('posts') || [];
  const newPost = {
    id: uid('p'), title: data.title, content: data.content, tags: data.tags||[], status: data.status||'draft',
    authorId: data.authorId, createdAt: now()
  };
  posts.push(newPost);
  LS.set('posts', posts);
  return newPost;
}
function updatePost(id, changes){
  const posts = LS.get('posts') || [];
  const i = posts.findIndex(p=>p.id===id); if(i===-1) return;
  posts[i] = {...posts[i], ...changes};
  LS.set('posts', posts);
}
function deletePost(id){
  let posts = LS.get('posts') || [];
  posts = posts.filter(p=>p.id!==id);
  LS.set('posts', posts);
}

/* Auth modal (login/register) */
function openAuthModal(mode){
  const modal = document.createElement('div');
  Object.assign(modal.style,{position:'fixed',inset:0,background:'rgba(0,0,0,0.4)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:9999});
  modal.innerHTML = `
    <div style="width:420px;background:#fff;padding:18px;border-radius:12px">
      <h3 style="margin:0 0 8px">${mode==='login' ? 'Login' : 'Create account'}</h3>
      <div style="display:flex;flex-direction:column;gap:8px">
        <input id="a_username" placeholder="Username (for signup)" style="padding:10px;border-radius:8px;border:1px solid #e6e6e6;display:${mode==='login'?'none':'block'}"/>
        <input id="a_email" placeholder="Email" style="padding:10px;border-radius:8px;border:1px solid #e6e6e6"/>
        <input id="a_pw" placeholder="Password" type="password" style="padding:10px;border-radius:8px;border:1px solid #e6e6e6"/>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button id="authCancel" class="ghost">Cancel</button>
          <button id="authSubmit" class="btn">${mode==='login'?'Login':'Sign Up'}</button>
        </div>
      </div>
    </div>
  `;
  document.body.appendChild(modal);
  $('#authCancel').onclick = ()=> modal.remove();
  $('#authSubmit').onclick = ()=> {
    const email = $('#a_email').value.trim();
    const pw = $('#a_pw').value;
    if(!email || !pw) return alert('Email & password required');
    if(mode==='login'){
      const users = LS.get('users')||[];
      const user = users.find(u=>u.email.toLowerCase()===email.toLowerCase());
      if(!user) return alert('User not found. Register first.');
      // naive auth: any password accepted (it's a demo)
      LS.set('session', { userId: user.id });
      modal.remove(); renderAuthArea(); route();
    } else {
      const username = $('#a_username').value.trim();
      if(!username) return alert('Choose a username');
      // create
      const users = LS.get('users')||[];
      if(users.find(u=>u.email.toLowerCase()===email.toLowerCase())) return alert('Email exists');
      const newUser = { id: uid('u'), username, email, bio:'', createdAt: now() };
      users.push(newUser); LS.set('users', users); LS.set('session',{userId:newUser.id});
      modal.remove(); renderAuthArea(); route();
    }
  };
}

/* utils */
function stripHtml(html){ const tmp = document.createElement('div'); tmp.innerHTML = html; return tmp.textContent||tmp.innerText||''; }
function formatDate(iso){ const d = new Date(iso); return d.toLocaleString(); }
function escapeHtml(s){ if(!s) return ''; return s.replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c])); }
function escapeAttr(s){ return (s||'').replace(/"/g,'&quot;'); }
function escapeHtmlAttr(s){ return (s||'').replace(/</g,'&lt;'); }

/* keyboard shortcut: 'n' for new post when logged in */
document.addEventListener('keydown', (e)=>{
  if(e.key === 'n' && !(e.ctrlKey||e.metaKey||e.altKey)){
    const s = LS.get('session'); if(s && s.userId) location.hash = '#/new'; else openAuthModal('login');
  }
});
</script>
</body>
</html>
